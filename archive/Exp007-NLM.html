<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Times+New+Roman:300,300italic,400,400italic,700,700italic%7CGeorgia:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha256-5eIC48iZUHmSlSUz9XtjRyK2mzQkHScZY1WdMaoz74E=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.31/fancybox/fancybox.css" integrity="sha256-gkQVf8UKZgQ0HyuxL/VnacadJ+D2Kox2TCEBuNQg5+w=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"hwchai.com","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.21.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":true,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="Antoni Buades 提出指标 method noise 对数字图像降噪方法的性能进行了评价和比较。他首先针对几个被广泛使用的降噪算法计算并分析了降噪性能。同时，基于图像中所有像素的非局部平均，提出了全新的数字图像降噪算法 Non Local means Algorithm，并通过实验比较了新算法与常用的平滑滤波方法的性能。">
<meta property="og:type" content="website">
<meta property="og:title" content="Non Local Means 图像降噪算法">
<meta property="og:url" content="https://hwchai.com/archive/Exp007-NLM.html">
<meta property="og:site_name" content="Hai-Wei Chai&#39;s Blog">
<meta property="og:description" content="Antoni Buades 提出指标 method noise 对数字图像降噪方法的性能进行了评价和比较。他首先针对几个被广泛使用的降噪算法计算并分析了降噪性能。同时，基于图像中所有像素的非局部平均，提出了全新的数字图像降噪算法 Non Local means Algorithm，并通过实验比较了新算法与常用的平滑滤波方法的性能。">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2020-09-30T20:53:23.000Z">
<meta property="article:modified_time" content="2020-09-30T19:04:01.000Z">
<meta property="article:author" content="Hai-Wei Chai (柴海伟)">
<meta property="article:tag" content="denoise">
<meta property="article:tag" content="Non Local Means">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://hwchai.com/archive/Exp007-NLM">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":false,"lang":"en","comments":true,"permalink":"https://hwchai.com/archive/Exp007-NLM.html","path":"archive/Exp007-NLM.html","title":"Non Local Means 图像降噪算法"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Non Local Means 图像降噪算法 | Hai-Wei Chai's Blog
</title>
  







<link rel="dns-prefetch" href="https://vercel.hwchai.com/">
  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Hai-Wei Chai's Blog</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-house-chimney fa-fw"></i>Home</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-list fa-fw"></i>Archives</a></li><li class="menu-item menu-item-support"><a href="/support/" rel="section"><i class="fa fa-screwdriver-wrench fa-fw"></i>Support</a></li><li class="menu-item menu-item-books"><a href="/books/" rel="section"><i class="fa fa-book fa-fw"></i>Books</a></li><li class="menu-item menu-item-scholar"><a href="/scholar/" rel="section"><i class="fa fa-chart-column fa-fw"></i>Scholar</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="Searching..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="nav-number">1.</span> <span class="nav-text">代码实现</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Introduction"><span class="nav-number">2.</span> <span class="nav-text">Introduction</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E5%AD%97%E5%9B%BE%E5%83%8F%E5%99%AA%E5%A3%B0"><span class="nav-number">2.1.</span> <span class="nav-text">数字图像噪声</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Method-noise"><span class="nav-number">2.2.</span> <span class="nav-text">Method noise</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B1%80%E9%83%A8%E5%B9%B3%E5%9D%87%E7%AE%97%E6%B3%95"><span class="nav-number">3.</span> <span class="nav-text">局部平均算法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AB%98%E6%96%AF%E6%BB%A4%E6%B3%A2-Gaussian-Filtering"><span class="nav-number">3.1.</span> <span class="nav-text">高斯滤波 (Gaussian Filtering)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%84%E5%90%91%E5%BC%82%E6%80%A7%E6%BB%A4%E6%B3%A2%EF%BC%88Anisotropic-Filtering-AF%EF%BC%89"><span class="nav-number">3.2.</span> <span class="nav-text">各向异性滤波（Anisotropic Filtering, AF）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#TV%E6%BB%A4%E6%B3%A2%EF%BC%88Total-Variation-Minimization%EF%BC%89"><span class="nav-number">3.3.</span> <span class="nav-text">TV滤波（Total Variation Minimization）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%82%BB%E5%9F%9F%E6%BB%A4%E6%B3%A2%EF%BC%88Neighborhood-Filtering%EF%BC%89"><span class="nav-number">3.4.</span> <span class="nav-text">邻域滤波（Neighborhood Filtering）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%9D%9E%E5%B1%80%E9%83%A8%E5%B9%B3%E5%9D%87%E7%AE%97%E6%B3%95%EF%BC%88Non-Local-Means-Algorithm%EF%BC%89"><span class="nav-number">4.</span> <span class="nav-text">非局部平均算法（Non Local Means Algorithm）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9E%E9%AA%8C%E5%8F%8A%E8%AE%A8%E8%AE%BA"><span class="nav-number">5.</span> <span class="nav-text">实验及讨论</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Code-and-Data"><span class="nav-number">6.</span> <span class="nav-text">Code and Data</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Hai-Wei Chai (柴海伟)"
      src="/images/gamersky.gif">
  <p class="site-author-name" itemprop="name">Hai-Wei Chai (柴海伟)</p>
  <div class="site-description" itemprop="description">I am a slow walker, but never backwards!</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">27</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">categories</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">26</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/haiweichai" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;haiweichai" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:chw9402@mail.ustc.edu.com" title="E-Mail → mailto:chw9402@mail.ustc.edu.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner page posts-expand">


    
    
    
    <div class="post-block" lang="en"><header class="post-header">

<h1 class="post-title" itemprop="name headline">Non Local Means 图像降噪算法
</h1>

<div class="post-meta-container">
</div>

</header>

      
      
      
      <div class="post-body">
          <p>Antoni Buades 提出指标 method noise 对数字图像降噪方法的性能进行了评价和比较。他首先针对几个被广泛使用的降噪算法计算并分析了降噪性能。同时，基于图像中所有像素的非局部平均，提出了全新的数字图像降噪算法 Non Local means Algorithm，并通过实验比较了新算法与常用的平滑滤波方法的性能。</p>
<span id="more"></span>

<h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> skimage <span class="keyword">import</span> data, img_as_float</span><br><span class="line"><span class="keyword">from</span> skimage.restoration <span class="keyword">import</span> denoise_nl_means, estimate_sigma</span><br><span class="line"><span class="keyword">from</span> skimage.metrics <span class="keyword">import</span> peak_signal_noise_ratio</span><br><span class="line"><span class="keyword">from</span> skimage.util <span class="keyword">import</span> random_noise</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">astro = img_as_float(data.astronaut())</span><br><span class="line">astro = astro[<span class="number">30</span>:<span class="number">180</span>, <span class="number">150</span>:<span class="number">300</span>]</span><br><span class="line"></span><br><span class="line">sigma = <span class="number">0.08</span></span><br><span class="line">noisy = random_noise(astro, var=sigma**<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># estimate the noise standard deviation from the noisy image</span></span><br><span class="line">sigma_est = np.mean(estimate_sigma(noisy, channel_axis=-<span class="number">1</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;estimated noise standard deviation = <span class="subst">&#123;sigma_est&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line">patch_kw = <span class="built_in">dict</span>(patch_size=<span class="number">5</span>,      <span class="comment"># 5x5 patches</span></span><br><span class="line">                patch_distance=<span class="number">6</span>,  <span class="comment"># 13x13 search area</span></span><br><span class="line">                channel_axis=-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># slow algorithm</span></span><br><span class="line">denoise = denoise_nl_means(noisy, h=<span class="number">1.15</span> * sigma_est, fast_mode=<span class="literal">False</span>,**patch_kw)</span><br><span class="line"></span><br><span class="line"><span class="comment"># slow algorithm, sigma provided</span></span><br><span class="line">denoise2 = denoise_nl_means(noisy, h=<span class="number">0.8</span> * sigma_est, sigma=sigma_est,fast_mode=<span class="literal">False</span>, **patch_kw)</span><br><span class="line"></span><br><span class="line"><span class="comment"># fast algorithm</span></span><br><span class="line">denoise_fast = denoise_nl_means(noisy, h=<span class="number">0.8</span> * sigma_est, fast_mode=<span class="literal">True</span>,**patch_kw)</span><br><span class="line"></span><br><span class="line"><span class="comment"># fast algorithm, sigma provided</span></span><br><span class="line">denoise2_fast = denoise_nl_means(noisy, h=<span class="number">0.6</span> * sigma_est, sigma=sigma_est,fast_mode=<span class="literal">True</span>, **patch_kw)</span><br><span class="line"></span><br><span class="line">fig, ax = plt.subplots(nrows=<span class="number">2</span>, ncols=<span class="number">3</span>, figsize=(<span class="number">8</span>, <span class="number">6</span>),sharex=<span class="literal">True</span>, sharey=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">ax[<span class="number">0</span>, <span class="number">0</span>].imshow(noisy)</span><br><span class="line">ax[<span class="number">0</span>, <span class="number">0</span>].axis(<span class="string">&#x27;off&#x27;</span>)</span><br><span class="line">ax[<span class="number">0</span>, <span class="number">0</span>].set_title(<span class="string">&#x27;noisy&#x27;</span>)</span><br><span class="line">ax[<span class="number">0</span>, <span class="number">1</span>].imshow(denoise)</span><br><span class="line">ax[<span class="number">0</span>, <span class="number">1</span>].axis(<span class="string">&#x27;off&#x27;</span>)</span><br><span class="line">ax[<span class="number">0</span>, <span class="number">1</span>].set_title(<span class="string">&#x27;non-local means\n(slow)&#x27;</span>)</span><br><span class="line">ax[<span class="number">0</span>, <span class="number">2</span>].imshow(denoise2)</span><br><span class="line">ax[<span class="number">0</span>, <span class="number">2</span>].axis(<span class="string">&#x27;off&#x27;</span>)</span><br><span class="line">ax[<span class="number">0</span>, <span class="number">2</span>].set_title(<span class="string">&#x27;non-local means\n(slow, using $\\sigma_&#123;est&#125;$)&#x27;</span>)</span><br><span class="line">ax[<span class="number">1</span>, <span class="number">0</span>].imshow(astro)</span><br><span class="line">ax[<span class="number">1</span>, <span class="number">0</span>].axis(<span class="string">&#x27;off&#x27;</span>)</span><br><span class="line">ax[<span class="number">1</span>, <span class="number">0</span>].set_title(<span class="string">&#x27;original\n(noise free)&#x27;</span>)</span><br><span class="line">ax[<span class="number">1</span>, <span class="number">1</span>].imshow(denoise_fast)</span><br><span class="line">ax[<span class="number">1</span>, <span class="number">1</span>].axis(<span class="string">&#x27;off&#x27;</span>)</span><br><span class="line">ax[<span class="number">1</span>, <span class="number">1</span>].set_title(<span class="string">&#x27;non-local means\n(fast)&#x27;</span>)</span><br><span class="line">ax[<span class="number">1</span>, <span class="number">2</span>].imshow(denoise2_fast)</span><br><span class="line">ax[<span class="number">1</span>, <span class="number">2</span>].axis(<span class="string">&#x27;off&#x27;</span>)</span><br><span class="line">ax[<span class="number">1</span>, <span class="number">2</span>].set_title(<span class="string">&#x27;non-local means\n(fast, using $\\sigma_&#123;est&#125;$)&#x27;</span>)</span><br><span class="line"></span><br><span class="line">fig.tight_layout()</span><br><span class="line"></span><br><span class="line"><span class="comment"># print PSNR metric for each case</span></span><br><span class="line">psnr_noisy = peak_signal_noise_ratio(astro, noisy)</span><br><span class="line">psnr = peak_signal_noise_ratio(astro, denoise)</span><br><span class="line">psnr2 = peak_signal_noise_ratio(astro, denoise2)</span><br><span class="line">psnr_fast = peak_signal_noise_ratio(astro, denoise_fast)</span><br><span class="line">psnr2_fast = peak_signal_noise_ratio(astro, denoise2_fast)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;PSNR (noisy) = <span class="subst">&#123;psnr_noisy:<span class="number">0.2</span>f&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;PSNR (slow) = <span class="subst">&#123;psnr:<span class="number">0.2</span>f&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;PSNR (slow, using sigma) = <span class="subst">&#123;psnr2:<span class="number">0.2</span>f&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;PSNR (fast) = <span class="subst">&#123;psnr_fast:<span class="number">0.2</span>f&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;PSNR (fast, using sigma) = <span class="subst">&#123;psnr2_fast:<span class="number">0.2</span>f&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>

<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><h3 id="数字图像噪声"><a href="#数字图像噪声" class="headerlink" title="数字图像噪声"></a>数字图像噪声</h3><p>&emsp;&emsp;数字图像的两个主要限制是模糊及噪声（blur &amp; noise）。模糊是图像采集系统的固有性质，同时数字图像对连续信号离散采样的形式必须遵循 Shannon-Nyquist 采样定律。另一种主要的干扰形式是噪声。数字图像中每个像素点的值 $u(i)$ 都是对局部光强测量的结果，通常通过 CCD 及光学聚焦元件实现。CCD 中每个方形探测单元（captor）都将记录曝光时间内探测区域的入射光子数。在光源强度恒定的情况下，每个探测单元每个曝光周期内采集的光子数的概率分布将遵循中心极限定理，在光强均值周围震荡。另外，如果 CCD 没有经过充分冷却就会接收热光子（heat spurious photons），由此产生的扰动通常称为 obscurity noise。</p>
<p>&emsp;&emsp;数字图像降噪方法的目标是从观测到的噪声图像中还原出原始信号，</p>
<p>$$ v(i)&#x3D;u(i)+n(i), \tag{1}\label{1}$$</p>
<p>其中 $v(i)$ 为实测图像，$u(i)$ 为原始信号，$n(i)$ 则是噪声信号。评估图像中噪声水平通常采用信噪比（signal noise ratio (SNR)）：</p>
<p>$$ SNR &#x3D; \frac{\sigma(u)}{\sigma(n)}, \tag{2}\label{2}$$</p>
<p>其中，$\sigma(n)$为噪声信号标准差，$\sigma(u)$表示真实信号的经验标准差，</p>
<p>$$ \sigma(u) &#x3D; \sqrt{\frac{1}{|I|}\sum_i(u(i)- \overline{u} )^2}, \tag{3}\label{3}$$</p>
<p>$ \overline{u}&#x3D;\frac{1}{|I|}\sum_{i\in I} u(i)$ 为图像的平均灰度值，$|I|$指全图像素数。当噪声模型和参数已知时，噪声的标准差也可以用经验测量法或形式化方法得到。</p>
<p>&emsp;&emsp;迄今为止，图像处理领域已经提出了诸多抑制噪声、还原真实信号的算法。即便它们通常拥有截然不同的数学形式，但都拥有一个共性：平均。这种平均可以在局部进行：高斯滤波器(<a target="_blank" rel="noopener" href="https://freddy.cs.technion.ac.il/wp-content/uploads/2018/01/on-gabors-contribution-to-image-enhancement.pdf">Gabor 1994</a>)，各向异性滤波(<a target="_blank" rel="noopener" href="https://authors.library.caltech.edu/6498/1/PERieeetpami90.pdf">Perona-Malik 1990</a>, <a target="_blank" rel="noopener" href="https://accedacris.ulpgc.es/bitstream/10553/52821/1/image_selective_smoothing_edge.pdf">Alvarez et al. 1992</a>)，邻域滤波器(<a target="_blank" rel="noopener" href="https://books.google.com/books?hl=en&lr=&id=zHPpCAAAQBAJ&oi=fnd&pg=PA2&dq=L.+Yaroslavsky.+Digital+Picture+Processing+-+An+Introduction.+Springer+Verlag,+1985.&ots=kNXsihR5hI&sig=1FSo9cLMzy_GZNZpIwTaGM_nGBw#v=onepage&q&f=false">Yaroslavsky 1985</a>, <a target="_blank" rel="noopener" href="http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.554.5808&rep=rep1&type=pdf">Smith et al. 1997</a>)；也可以通过计算variations实现：TV滤波(<a target="_blank" rel="noopener" href="https://www-pequan.lip6.fr/~bereziat/cours/master/vision/papers/rudin92.pdf">Rudin-Osher-Fatemi 1992</a>)；或是在频域进行：经验维纳滤波(<a target="_blank" rel="noopener" href="https://books.google.com/books?hl=en&lr=&id=zHPpCAAAQBAJ&oi=fnd&pg=PA2&dq=L.+Yaroslavsky.+Digital+Picture+Processing+-+An+Introduction.+Springer+Verlag,+1985.&ots=kNXsihR5hI&sig=1FSo9cLMzy_GZNZpIwTaGM_nGBw#v=onepage&q&f=false">Yaroslavsky 1985</a>)，小波阈值方法(<a target="_blank" rel="noopener" href="https://pdfs.semanticscholar.org/78a5/90a8ac92f02fb48e4e488b6eb00dc7b931eb.pdf">Coiffman-Donoho 1995</a>)。</p>
<h3 id="Method-noise"><a href="#Method-noise" class="headerlink" title="Method noise"></a>Method noise</h3><p>&emsp;&emsp;不妨令 $u$ 表示实测图像，$D_hu$ 表示降噪方法的输出结果，$h$ 为滤波参数。Antoni Buades 定义 method noise 为降噪前后图像之差：</p>
<p>$$ u-D_hu. \tag{4}\label{4}$$</p>
<p>&emsp;&emsp;完美的降噪算法在应用中不应该改变无噪声图像。因此，当图像具有某种规律性时，method noise 理应很小。对理想的降噪算法，Method noise 必须看起来与随机噪声无异，几乎不包含原始信号的结构。因为即便是质量非常高的实测图像，噪声也是不可避免的，计算 method noise 对评估任何降噪算法都是有意义的，而非传统的“添加噪声，再去除噪声”的把戏。</p>
<h2 id="局部平均算法"><a href="#局部平均算法" class="headerlink" title="局部平均算法"></a>局部平均算法</h2><h3 id="高斯滤波-Gaussian-Filtering"><a href="#高斯滤波-Gaussian-Filtering" class="headerlink" title="高斯滤波 (Gaussian Filtering)"></a>高斯滤波 (Gaussian Filtering)</h3><p>&emsp;&emsp;对数字图像进行各向同性过滤，本质上可以归结为图像与各向同性核的卷积。采用数值呈现出高斯分布的卷积核，既是高斯滤波，是图像处理中最常用的操作之一。通俗的讲，高斯滤波就是对整幅图像进行加权平均的过程，每一个像素点的值，都由其本身和邻域内的其他像素值经过加权平均后得到（所有的局部平滑滤波方法都是如此）。高斯卷积核：</p>
<p>$$G_h(x)&#x3D;\frac{1}{4\pi h^2}e^{-\frac{|x|^2}{4h^2}}. \tag{5}\label{5}$$</p>
<p><strong>Theorem 1 (Babor 1960):</strong> 当高斯卷积核的特征尺寸 $h$ 极小时，高斯滤波的 method noise 为：</p>
<p>$$ u-G_h* u&#x3D;-h^2\Delta u+o(h^2). \tag{6}\label{6}$$</p>
<p>&emsp;&emsp;高斯滤波的 method noise 在图像谐波部分几乎为零，而在边缘、纹理区域非常大。因此，高斯滤波在图像的平坦区域相对表现优秀，但在边缘、纹理区域较为模糊（blurred）。</p>
<h3 id="各向异性滤波（Anisotropic-Filtering-AF）"><a href="#各向异性滤波（Anisotropic-Filtering-AF）" class="headerlink" title="各向异性滤波（Anisotropic Filtering, AF）"></a>各向异性滤波（Anisotropic Filtering, AF）</h3><p>&emsp;&emsp;各向异性滤波提出之初旨在解决高斯滤波在边缘及纹理区域的模糊问题。该算法通过只在 $Du(\vec x)$ 正交方向上计算图像 $u$ 在 $\vec x$ 处的卷积。这种想法可以追溯到 <a target="_blank" rel="noopener" href="https://authors.library.caltech.edu/6498/1/PERieeetpami90.pdf">Perona &amp; Malik</a>。各向异性滤波算法的定义为：</p>
<p>$$ AF_hu(\vec x)&#x3D;\int G_h(t)u(\vec x+t\frac{Du(\vec x)^\perp}{|Du(\vec x)|})dt, \tag{7}\label{7}$$</p>
<p>在 $\vec x$ 处，当 $Du(\vec x)\neq0$ 时成立。$(x,y)^\perp&#x3D;(-y,x)$，且 $G_h$ 代指方差 $h^2$ 的一维高斯函数。假设原始图像 $u$ 在 $\vec x$ 处二次连续可微（twice continuously differentiable ($C^2$)）,将式\eqref{5}二次泰勒展开（second order Taylor expansion）可以推导出：</p>
<p><strong>Theorem 2:</strong> 当 $Du(\vec x)\neq0$ 时，各向异性滤波 $AF_h$ 的 method noise 为：</p>
<p>$$ u(\vec x)-AF_hu(\vec x)&#x3D;-\frac{1}{2}h^2|Du|curv(u)(\vec x)+o(h^2), \tag{8}\label{8}$$</p>
<p>$curv(u)(\vec x)$ 指局部曲率（<font color=Green>此处存疑</font>），即经过 $\vec x$ 点的水平直线上曲率半径的逆（signed inverse）。在图像 $u$ 中局部几乎为一条直线的区域，method noise 几乎为零，而在弯曲的边缘或纹理区域较大。因而，各向异性滤波对直边区域得以保持，而平坦、纹理区域图像精度有所退化。</p>
<h3 id="TV滤波（Total-Variation-Minimization）"><a href="#TV滤波（Total-Variation-Minimization）" class="headerlink" title="TV滤波（Total Variation Minimization）"></a>TV滤波（Total Variation Minimization）</h3><p>&emsp;&emsp;全变分图像去噪算法最早由 <a target="_blank" rel="noopener" href="https://www-pequan.lip6.fr/~bereziat/cours/master/vision/papers/rudin92.pdf">Rudin, Osher and Fatemi</a>提出。给定一幅实测图像 $v(\vec x)$，该算法将恢复原始信号 $u(\vec x)$ 的问题转化为式\eqref{7}的最小化问题：</p>
<p>$$TVF_\lambda(v)&#x3D;{\rm arg},\underset{u}{\rm \mathop {min}},TV(u)+\lambda\int|v(\vec x)-u(\vec x)|^2d\vec x, \tag{9}\label{9}$$</p>
<p>其中 $TV(u)$ 为图像 $u$ 的全变分，$\lambda$ 为给定的拉格朗日乘子（Lagrange multiplier）。上述最小化问题的最小值存在且唯一。参数 $\lambda$ 与噪声的统计信息相关，并控制了滤波程度。</p>
<p><strong>Theorem 3:</strong> TV滤波的 method noise 为：</p>
<p>$$ u(\vec x)-TVF_\lambda(u)(\vec x)&#x3D;-\frac{1}{2\lambda}curv(TVF_\lambda(u))(\vec x). \tag{10}\label{10}$$</p>
<p>&emsp;&emsp;在各向异性的情况下，直边由于曲率小而得以保持。但 $\lambda$ 过小时细节及纹理会被过度平滑。</p>
<h3 id="邻域滤波（Neighborhood-Filtering）"><a href="#邻域滤波（Neighborhood-Filtering）" class="headerlink" title="邻域滤波（Neighborhood Filtering）"></a>邻域滤波（Neighborhood Filtering）</h3><p>&emsp;&emsp;我们称邻域滤波为将临近区域内具有相似灰度值的像素取平均以期恢复原始信号的滤波器。<a target="_blank" rel="noopener" href="https://books.google.com/books?hl=en&lr=&id=zHPpCAAAQBAJ&oi=fnd&pg=PA2&dq=L.+Yaroslavsky.+Digital+Picture+Processing+-+An+Introduction.+Springer+Verlag,+1985.&ots=kNXsihR5hI&sig=1FSo9cLMzy_GZNZpIwTaGM_nGBw#v=onepage&q&f=false">Yaroslavsky(1985)</a>首次提出的方法通过计算空间邻域 $B_\rho(\vec x)$ 内具有相似灰度值像素的平均来恢复信号：</p>
<p>$$ YNF_{h,\rho}u(\vec x)&#x3D;\frac{1}{C(\vec x)}\int_{B_\rho (\vec x)} u(\vec y)e^{-\frac{|u(\vec y)-u(\vec x)|^2}{h^2}}d\vec y, \tag{11}\label{11}$$</p>
<p>其中，$\vec x\in\Omega$，$C(\vec x)&#x3D;\int_{B_\rho(\vec x)} e^{-\frac{|u(\vec y)-u(\vec x)|^2}{h^2}}d\vec y$ 为归一化常量，$h$ 为滤波参数。</p>
<p>&emsp;&emsp;较晚提出的邻域滤波算法相较 Yaroslavsky 滤波要更广为人知一些，既 SUSAN 滤波（1995）及双边滤波（1998）。这些滤波算法都引入到参考像素 $\vec x$ 的距离作为权重因子，而非单纯的考虑一个固定范围的邻域，</p>
<p>$$SNF_{h,\rho}u(\vec x)&#x3D;\frac{1}{C(\vec x)}\int_{\Omega} u(\vec y)e^{-\frac{|y-x|^2}{\rho^2}}e^{-\frac{|u(\vec y)-u(\vec x)|^2}{h^2}}d\vec y, \tag{12}\label{12}$$</p>
<p>这里 $C(\vec x)&#x3D;\int_{\Omega}e^{-\frac{|y-x|^2}{\rho^2}}e^{-\frac{|u(\vec y)-u(\vec x)|^2}{h^2}}d\vec y$ 为归一化常量，$\rho$ 为空间滤波参数（spatial filtering parameter）。事实上，$YNF_{h,\rho}$ 与 $SNF_{h,\rho}$ 之间并没有本质区别（<font color=Green>此处存疑</font>）。如果两个区域的灰度值差异大于 $h$，这些算法都将计算来自于同一区域的像素灰度平均值来恢复参考点的原始信号。因而该算法不会模糊边界区域，这是正是该类算法最核心的用途。</p>
<p>&emsp;&emsp;然而这类算法的问题是，只将单个像素作为参考点，而如若该参考像素恰好被噪声干扰严重，滤波效果将不够鲁棒（robust）。同时，邻域滤波器也会制造人为干扰（artificial shocks），这将会在它的 method noise 中展示出来。</p>
<h2 id="非局部平均算法（Non-Local-Means-Algorithm）"><a href="#非局部平均算法（Non-Local-Means-Algorithm）" class="headerlink" title="非局部平均算法（Non Local Means Algorithm）"></a>非局部平均算法（Non Local Means Algorithm）</h2><p>&emsp;&emsp;Antoni Buades 于 2005 年提出非局部平均数字图像降噪算法（Non Local Algorithm）。给定一幅实测图像 $v&#x3D;\lbrace v(i)|i\in I\rbrace $，像素 $i$ 处的估计值 $NL[v](i)$ 是该图像上所有像素点的加权平均值，</p>
<p>$$ NL<a href="i">v</a>&#x3D;\sum_{j\in I}\omega(i,j)v(j), \tag{13}\label{13}$$</p>
<p>这里的权重系数 $\lbrace\omega (i,j)\rbrace_j$ 取决于像素 $i$ 与 $j$ 之间的相似程度，且始终满足如下标准： $0\leq\omega(i,j)\leq 1$ 且 $\sum_{j} \omega(i,j)&#x3D;1$（等价于上文介绍的滤波算法中归一化常量）。</p>
<p>&emsp;&emsp;俩个像素 $(i,j)$ 之间的相似程度取决于邻域灰度矩阵 $v(N_i)$ 及 $v(N_j)$（intensity gray level vectors），这里 $N_k$ 指以像素 $k$ 为中心，给定尺寸的方形邻域。这种相似性被定义为加权欧式距离的递减函数，$\parallel v(N_i)-v(N_j)\parallel_{2,a}^2$，其中 $a&gt;0$ 是高斯卷积核的标准差。欧式距离对噪声邻域的应用引入了如下等式：</p>
<p>$$ E\parallel v(N_i)-v(N_j)\parallel_{2,a}^2 &#x3D; \parallel u(N_i)-u(N_j) \parallel_{2,a}^2+2\sigma^2. \tag{14}\label{14}$$</p>
<p>&emsp;&emsp;这个等式证明了该算法的鲁棒性（robustness）。因为含噪声的实测图像 $v$ 的欧式距离期望恰恰遵循真正的原始信号之间的相似性。</p>
<p>&emsp;&emsp;与 $v(N_i)$ 具有相似灰度邻域的像素在计算平均时的权重因子更大，</p>
<p>$$ \omega(i,j)&#x3D;\frac{1}{Z(i)}e^{-\cfrac{\parallel v(N_i)-v(N_j) \parallel_{2,a}^2}{h^2}}, \tag{15}\label{15}$$</p>
<p>这里，$Z(i)$ 为归一化常量，</p>
<p>$$ Z(i) &#x3D; \sum_j e^{-\cfrac{\parallel v(N_i)-v(N_j) \parallel_{2,a}^2}{h^2}}, \tag{16}\label{16}$$</p>
<p>参数 $h$ 控制滤波程度，它直接影响了指数函数的衰减趋势，进而控制欧式距离对权重因子衰减速度的影响。</p>
<p>&emsp;&emsp;NL-means 算法不仅仅考虑单个像素的灰度值，而是考虑该像素整个邻域的几何构型，这正是 NL-means 算法比邻域滤波更鲁棒的原因。图$(1)$ 也说明了这个问题，像素 $q3$ 与 $p$ 具有完全一致的灰度值，而邻域的几何构型完全不同，导致 NL-means 中的权重因子 $\omega(p,q3)$ 几乎为零。</p>
<p>&lt;img src&#x3D;”&#x2F;Exp002_image001.jpg” width &#x3D; 30% div align&#x3D;center &#x2F; title&#x3D;”图1.  NL-means 算法方案。相似的像素邻域将提供更大的权重，如 $\omega(p,q1), \omega(p,q2)$，而不相似的邻域提供的权重几乎为零，如 $\omega(p,q3)$。”&gt;</p>
<p>&nbsp;<br>&emsp;&emsp;NL-means 算法最终的数学形式：</p>
<p>$$ NL<a href="x">v</a>&#x3D;\frac{1}{C(x)} \int_{\Omega} e^{-\cfrac{(G_a * |v(x+.)-v(y+.)|^2)(0)}{h^2}}v(y)dy, \tag{17}\label{17}$$</p>
<p>$x\in\Omega$，$C(x)&#x3D;\int_{\Omega} {\rm exp}\lbrack -\frac{(G_a* |u(x+.)-u(z+.)|^2)(0)}{h^2}\rbrack dz$ 为归一化常量，$G_a$ 为高斯核，$h$ 控制过滤程度。</p>
<p>&emsp;&emsp;NL-means 算法的中心思想是：像素 $x$ 处的信息恢复，是由整幅图像内所有邻域与像素 $x$ 邻域相似的点取平均得到的。与局部滤波算法或频域滤波算法相比，NL-means 算法的主要区别在于可以系统地运用整幅图像中所有可能自预测局部结构的信息。</p>
<h2 id="实验及讨论"><a href="#实验及讨论" class="headerlink" title="实验及讨论"></a>实验及讨论</h2><p>&emsp;&emsp;本节将针对以下三点比较 Non Local Means 算法与局部平滑滤波的性能： method noise，视觉效果，均方差（mean square error）。这里均方差指修复图像与真实图像的欧几里得差异（Euclidean difference）。</p>
<p>&emsp;&emsp;在实现 NL-means 算法时，我们将相似邻域的搜索范围约束在一个较大的 $S\times S$ pixels 区域内。在所有的实验中均固定该搜索范围为 $21\times 21$ pixels，并指定邻域 $N_i$ 范围为 $7\times 7$ pixels。不妨设输入图像的像素数为 $N^2$，那么该算法的时间复杂度约为 $21^2\times 7^2 \times N^2$。</p>
<p>&lt;img src&#x3D;”&#x2F;Exp002_image002.jpg” width &#x3D; 70% div align&#x3D;center &#x2F; title&#x3D;”图2.  NL-means 权重分布。每组中左图中心像素为参考像素点 $x$，每组中右图为权重因子分布，由黑至白对应从0到1。”&gt;</p>
<p>&nbsp;<br>&emsp;&emsp;$7\times 7$ pixels 的邻域范围已经足够大，能够确保算法对噪声是鲁棒的；也足够小，让细节及纹理得以保持。滤波参数 $h$ 被设置为 $10\sigma$，这里 $\sigma$ 为人工添加高斯白噪声的标准差。由于指数权重的快速衰减，距离中心较远像素的权重几乎为零，这发挥了自动剔除远处像素的作用。Non Local means 算法的权重分布见图$(2)$。</p>
<p>&lt;img src&#x3D;”&#x2F;Exp002_image003.jpg” width &#x3D; 70% div align&#x3D;center &#x2F; title&#x3D;”图3.  对自然图像的降噪实验。从左至右：含噪声的实测图像（噪声标准差 35），高斯滤波，各向异性滤波，TV滤波，邻域滤波及 NL-means 算法。”&gt;</p>
<p>&nbsp;<br>&emsp;&emsp;在前面的段落中，我们明确的计算了各种局部平滑滤波方法的 method noise 理论值。图$(4)$ 的可视化实验证明了前文中公式的正确性。图$(4)$ 对比了数种降噪方法对含噪声lena图像运算的 method noise，噪声为高斯白噪声，标准差 2.5，滤波参数 $h$ 均相同。Method noise 能更好的协助判断降噪算法的性能及局限，因为被移除或改变的纹理、细节将被 method noise 醒目的展示出来。对比图$(4)$ 中数种降噪算法，NL-means 算法的 method noise 几乎无法察觉任何几何纹理。图$(2)$ 可以解释这一现象，因为 NL-means 算法选取的权重因子完全适应图像局部及非局部的几何结构。</p>
<p>&lt;img src&#x3D;”Exp002_image004.jpg” width &#x3D; 55% div align&#x3D;center &#x2F; title&#x3D;”图4.  降噪算法的method noise。从左到右，由上至下：噪声图像（标准差 20），高斯滤波，各向异性滤波，TV滤波，邻域滤波及 NL-means 算法。视觉实验验证了第二节的计算公式。”&gt;</p>
<p>&nbsp;<br>&emsp;&emsp;由于算法本身的性质，纹理及周期性结构是 NL-means 算法最适用的情况。因为对任意像素 $i$，纹理图像或周期性图像中将可以找到大量与该像素具有相似邻域的点，如图$(2.e)$。图$(3)$ 展示了局部平滑滤波器及 NL-means 算法对自然纹理的平滑效果。</p>
<p>&emsp;&emsp;自然图像同样含有足够的信息冗余会被 NL-means 恢复。平坦区域内部将呈现出大量相似的几何结构，见图$(2.a)$。直边界、或弯曲边界将被筛选出一条结构相似的像素线，见图$(2. b)，(2.c)$。并且，NL-means 将会在很远的位置寻找到与参考点相似的结构，如图$(2.f)$。图$(5)$ 展示了一次对自然图像的可视化实验，这组结果与图$(4)$ 是相对应的。</p>
<p>&lt;img src&#x3D;”&#x2F;Exp002_image005.jpg” width &#x3D; 55% div align&#x3D;center &#x2F; title&#x3D;”图5.  对自然图像的降噪实验。从左到右，由上至下：噪声图像（标准差 20），高斯滤波，各向异性滤波，TV滤波，邻域滤波及 NL-means 算法。”&gt;</p>
<p>&nbsp;<br>&emsp;&emsp;最后，表$(1)$ 展示了本文介绍的降噪方法的均方差。这种数值测量方法是最客观的，因为它不依赖于任何肉眼视觉上的解释。然而，这个误差在实际问题中是不可计算的（原始信号是未知的），小的均方误差并不能保证高的视觉质量。因此，以上讨论的标准似乎是比较算法性能的必要条件。</p>
<p>&lt;img src&#x3D;”&#x2F;Exp002_image006.jpg” width &#x3D; 35% div align&#x3D;center &#x2F; title&#x3D;”表1.  均方误差表。均方误差越小，降噪后越接近原始图像。”&gt;</p>
<p>&nbsp;<br>&lt;img src&#x3D;”&#x2F;Exp002_image007.jpg” width &#x3D; 60% div align&#x3D;center &#x2F; title&#x3D;”图6.  多种滤波方法对周期性图像应用结果。从左到右、从上到下：含噪声图像（标准差 35）；高斯滤波；TV滤波；邻域滤波；维纳滤波（ideal filter）；Hard TIWT；DCT 经验维纳滤波；NL-means 算法。”&gt;</p>
<p>&nbsp;<br>&lt;img src&#x3D;”&#x2F;Exp002_image008.jpg” width &#x3D; 40% div align&#x3D;center &#x2F; title &#x3D; “图7.  多种滤波方法对自然图像应用结果。从左到右、从上至下：含噪声图像（标准差 25）；DCT 经验维纳滤波；Hard TIWT；NL-means 算法。”&gt;</p>
<h2 id="Code-and-Data"><a href="#Code-and-Data" class="headerlink" title="Code and Data"></a>Code and Data</h2><p>&emsp;&emsp;Non-local means 方法 C 语言实现：<a target="_blank" rel="noopener" href="http://www.ipol.im/pub/art/2011/bcm_nlm/">http://www.ipol.im/pub/art/2011/bcm_nlm&#x2F;</a></p>

      </div>
      
      
      
    </div>

    
    


    <div class="comments" id="waline"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 2019 – 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-user"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Hai-Wei Chai (柴海伟)</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.31/fancybox/fancybox.umd.js" integrity="sha256-a+H7FYzJv6oU2hfsfDGM2Ohw/cR9v+hPfxHCLdmCrE8=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pangu/4.0.7/pangu.min.js" integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>




  <script src="/js/third-party/fancybox.js"></script>



  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"all","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


<script class="next-config" data-name="waline" type="application/json">{"lang":"zh-cn","enable":true,"serverURL":"https://vercel.hwchai.com/","cssUrl":"https://hwchai.com/download/Waline.css","commentCount":true,"pageview":false,"locale":{"placeholder":"请留下邮箱，若有回复您将收到提醒。QQ邮箱可以自动识别头像喔~"},"pageSize":10,"visitor":false,"comment_count":true,"meta":["nick","mail","link"],"requiredMeta":["nick"],"libUrl":"//unpkg.com/@waline/client@v2/dist/waline.js","emoji":["https://unpkg.com/@waline/emojis@1.0.1/bilibili"],"login":"disable","el":"#waline","comment":true,"path":"/archive/Exp007-NLM.html"}</script>
<link rel="stylesheet" href="https://hwchai.com/download/Waline.css">
<script>
document.addEventListener('page:loaded', () => {
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script>

</body>
</html>
